<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Letter — Dear Generator</title>
  <style>
    /* ถ้ามี Georgia Pro Condensed ให้วางที่ /fonts/GeorgiaProCondensed.woff2 */
    @font-face {
      font-family: 'GeorgiaProCondensedLocal';
      src: url('./fonts/GeorgiaProCondensed.woff2') format('woff2'),
           url('./fonts/GeorgiaProCondensed.woff') format('woff');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    :root{
      --letter-w: 900px; /* ขนาดกรอบจดหมายบนเว็บ (ปรับได้) */
      --letter-h: 1125px;
      --bg-color: #f6f6f6;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      gap:20px;
      align-items:flex-start;
      justify-content:center;
      background:#0f1113;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#eaeaea;
      padding:28px;
    }

    /* กล่องซ้าย: จดหมายตัวอย่าง */
    .canvas-wrap{
      width: var(--letter-w);
      max-width:90vw;
      box-shadow: 0 18px 50px rgba(0,0,0,.6);
      border-radius:6px;
      overflow:hidden;
      background: var(--bg-color);
    }

    /* จดหมายจริง (อัตราส่วนคงที่) */
    .letter {
      position: relative;
      width:100%;
      height: calc(var(--letter-h) * (var(--letter-w) / 900)); /* ปรับอัตโนมัติตามความกว้าง */
      background: #fff center/cover no-repeat;
      background-image: url('./ssuks.jpg');
      background-size: contain;
      background-position: center top;
    }

    /* โครงข้อความที่จะไปต่อหลัง Dear. */
    .overlay {
      position: absolute;
      top: 155px;    /* ค่าเริ่มต้น — ปรับได้ด้วย slider */
      left: 245px;   /* ค่าเริ่มต้น — ปรับได้ด้วย slider */
      transform: translate(0, 0);
      pointer-events: none;
      white-space: nowrap;
    }

    .overlay .name {
      font-family: 'GeorgiaProCondensedLocal', Georgia, "Times New Roman", serif;
      font-size: 46px; /* ค่าเริ่มต้น ให้เท่ากับ Dear. ของภาพ */
      line-height: 1;
      color: #111; /* สีเข้มเพื่อให้กลมกับตัวอักษรในภาพ */
      text-rendering: optimizeLegibility;
    }

    /* กล่องขวา: controls */
    .controls {
      width:360px;
      max-width: 38vw;
      background: #0f1316;
      border-radius:10px;
      padding:16px;
      box-shadow: 0 8px 30px rgba(0,0,0,.6);
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .controls h3{margin:0 0 6px 0;font-size:18px;color:#fff}
    label{font-size:13px;color:#bbb}
    input[type="text"]{
      width:100%; padding:10px;border-radius:8px;border:1px solid #222;background:#0b0d0e;color:#fff;font-size:16px;
    }
    .row{display:flex;gap:8px;align-items:center}
    .row > input[type="range"]{flex:1}
    .small{font-size:12px;color:#9aa; margin-top:6px}
    button{
      margin-top:8px;padding:10px;border-radius:8px;border:none;background:#1f6feb;color:#fff;font-weight:600;cursor:pointer;
    }
    button:active{transform:translateY(1px)}
    .note{font-size:12px;color:#778; margin-top:6px}

    footer{position:fixed;left:16px;bottom:12px;color:#666;font-size:12px}
    @media(max-width:950px){
      body{flex-direction:column;align-items:center}
      .controls{max-width:90vw;width:90%}
      footer{position:static;margin-top:10px}
    }
  </style>
</head>
<body>

  <div class="canvas-wrap" aria-label="Letter preview">
    <div id="letter" class="letter" role="img" aria-label="Letter background">
      <div id="overlay" class="overlay">
        <div id="nameText" class="name">ชื่อของคุณ</div>
      </div>
    </div>
  </div>

  <aside class="controls" aria-label="Controls">
    <h3>ปรับข้อความบนจดหมาย</h3>

    <label for="nameInput">ชื่อที่จะต่อหลังคำว่า <strong>Dear.</strong></label>
    <input id="nameInput" type="text" placeholder="พิมพ์ชื่อ เช่น อาทิตย์" />

    <label>ขนาดตัวอักษร (px): <span id="fontSizeVal">46</span></label>
    <div class="row">
      <input id="fontSize" type="range" min="24" max="120" value="46" />
    </div>

    <label>ตำแหน่งแนวนอน (ซ้าย → ขวา): <span id="leftVal">245px</span></label>
    <div class="row">
      <input id="leftRange" type="range" min="0" max="700" value="245" />
    </div>

    <label>ตำแหน่งแนวตั้ง (บน → ล่าง): <span id="topVal">155px</span></label>
    <div class="row">
      <input id="topRange" type="range" min="0" max="800" value="155" />
    </div>

    <label for="previewScale">ขนาด preview (หน้าจอเท่านั้น)</label>
    <select id="previewScale" style="padding:8px;border-radius:6px;background:#0b0d0e;color:#fff;border:1px solid #222">
      <option value="900">ขนาดจริง (900px กว้าง)</option>
      <option value="700">เล็กลง 700px</option>
      <option value="500">เล็กลง 500px</option>
    </select>

    <button id="downloadBtn">ดาวน์โหลดเป็น PNG (ความละเอียดดี)</button>

    <div class="note">วางไฟล์ <code>ssuks.jpg</code> ไว้ในโฟลเดอร์เดียวกับไฟล์นี้บน repo ของคุณ (หรือเปลี่ยนชื่อภาพใน CSS ถ้าจะใช้ชื่ออื่น)</div>
    <div class="small">ถ้ามีฟอนต์ Georgia Pro Condensed ให้วางที่ <code>/fonts/GeorgiaProCondensed.woff2</code> เพื่อให้ตัวอักษรตรงกับต้นฉบับมากที่สุด</div>
  </aside>

  <footer>ไฟล์เดียวพร้อมใช้งาน — วาง `index.html` + `ssuks.jpg` ขึ้น GitHub แล้วเปิดด้วย GitHub Pages</footer>

  <!-- html2canvas -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    // Elements
    const nameInput = document.getElementById('nameInput');
    const nameText = document.getElementById('nameText');
    const fontSize = document.getElementById('fontSize');
    const fontSizeVal = document.getElementById('fontSizeVal');
    const leftRange = document.getElementById('leftRange');
    const leftVal = document.getElementById('leftVal');
    const topRange = document.getElementById('topRange');
    const topVal = document.getElementById('topVal');
    const overlay = document.getElementById('overlay');
    const downloadBtn = document.getElementById('downloadBtn');
    const letter = document.getElementById('letter');
    const previewScale = document.getElementById('previewScale');

    // Init values (matches CSS defaults)
    fontSizeVal.textContent = fontSize.value;
    leftVal.textContent = leftRange.value + 'px';
    topVal.textContent = topRange.value + 'px';

    // Handlers
    nameInput.addEventListener('input', () => {
      const v = nameInput.value.trim();
      nameText.textContent = v ? v : 'ชื่อของคุณ';
    });

    fontSize.addEventListener('input', () => {
      fontSizeVal.textContent = fontSize.value;
      nameText.style.fontSize = fontSize.value + 'px';
    });

    leftRange.addEventListener('input', () => {
      leftVal.textContent = leftRange.value + 'px';
      overlay.style.left = leftRange.value + 'px';
    });

    topRange.addEventListener('input', () => {
      topVal.textContent = topRange.value + 'px';
      overlay.style.top = topRange.value + 'px';
    });

    previewScale.addEventListener('change', () => {
      const w = parseInt(previewScale.value, 10);
      document.documentElement.style.setProperty('--letter-w', w + 'px');
      // height adjusts automatically because of aspect calc in CSS
    });

    // Download (html2canvas)
    downloadBtn.addEventListener('click', async () => {
      downloadBtn.disabled = true;
      downloadBtn.textContent = 'กำลังสร้างรูป...';

      try {
        // Ensure background image is loaded (use same origin image to avoid taint)
        const canvas = await html2canvas(letter, {
          scale: 2,           // higher resolution
          useCORS: true,
          backgroundColor: null,
          logging: false
        });

        const dataUrl = canvas.toDataURL('image/png');
        const a = document.createElement('a');
        a.href = dataUrl;
        // filename uses name if provided
        const filename = (nameInput.value.trim() ? nameInput.value.trim().replace(/\s+/g,'_') : 'letter') + '.png';
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        a.remove();
      } catch (err) {
        console.error(err);
        alert('เกิดข้อผิดพลาดในการสร้างภาพ — ตรวจสอบว่าไฟล์ ssuks.jpg อยู่ในตำแหน่งเดียวกับไฟล์นี้บน server/GitHub');
      } finally {
        downloadBtn.disabled = false;
        downloadBtn.textContent = 'ดาวน์โหลดเป็น PNG (ความละเอียดดี)';
      }
    });

    // small convenience: center overlay if user clears
    window.addEventListener('load', () => {
      // keep defaults; user can fine-tune with sliders
      overlay.style.left = leftRange.value + 'px';
      overlay.style.top = topRange.value + 'px';
      nameText.style.fontSize = fontSize.value + 'px';
    });
  </script>
</body>
</html>
